{% extends 'base.html' %}

{% include 'journal/sidebar.html' %}
{% block content %}
    <div class="row">
        <div class="col-xs-4 col-sm-4 col-md-4 col-lg-4">
            <div class="box box-solid">
                <div class="box-header with-border">
                    <h3 class="box-title">Информация</h3>
                </div>
                <div class="box-body">
                    <div class="table-responsive">
                        <table class="table table-striped">
                            <tr>
                                <td class="col-xs-2 col-sm-2 col-md-2 col-lg-2">
                                    <strong>
                                        Взвод
                                    </strong>
                                </td>
                                <td>
                                    {{ student.squad.code }}
                                </td>
                            </tr>
                            <tr>
                                <td class="col-xs-2 col-sm-2 col-md-2 col-lg-2">
                                    <strong>
                                        ФИО
                                    </strong>
                                </td>
                                <td>
                                    {{ student.last_name }} {{ student.first_name }} {{ student.middle_name }}
                                </td>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xs-4 col-sm-4 col-md-4 col-lg-4">
            <div class="box box-solid">
                <div class="box-header with-border">
                    <h3 class="box-title">Средний балл по дисциплинам</h3>
                </div>
                <div class="box-body">
                    <div class="table-responsive">
                        <table class="table table-striped">
                            {% if not avg_marks %}
                                <strong> нет оценок</strong>
                            {% else %}
                                {% for st in avg_marks %}
                                    <tr>
                                        <td class="col-xs-2 col-sm-2 col-md-2 col-lg-2">
                                            <strong>
                                                {{ st.short }}
                                            </strong>
                                        </td>
                                        <td>
                                            {% if st.avg %}
                                                {{ st.avg|floatformat:2 }}
                                            {% else %}
                                                нет оценок
                                            {% endif %}
                                        </td>
                                    </tr>
                                {% endfor %}
                            {% endif %}
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xs-4 col-sm-4 col-md-4 col-lg-4">
            <div class="box box-solid">
                <div class="box-header with-border">
                    <h3 class="box-title">Посещаемость</h3>
                </div>
                <div class="box-body">
                    <div class="table-responsive">
                        <table class="table table-striped">
                            <tr>
                                <td class="col-xs-2 col-sm-2 col-md-2 col-lg-2">
                                    <strong>
                                        Неуважительная причина
                                    </strong>
                                </td>
                                <td>
                                    {{ attendance.truant }}
                                </td>
                            </tr>
                            <tr>
                                <td class="col-xs-2 col-sm-2 col-md-2 col-lg-2">
                                    <strong>
                                        Уважительная причина
                                    </strong>
                                </td>
                                <td>
                                    {{ attendance.absent }}
                                </td>
                            </tr>
                            <tr>
                                <td class="col-xs-2 col-sm-2 col-md-2 col-lg-2">
                                    <strong>
                                        В наряде
                                    </strong>
                                </td>
                                <td>
                                    {{ attendance.duty }}
                                </td>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xs-4 col-lg-4">
            <div class="box box-solid">
                <div class="box-header with-border">
                    <h3 class="box-title">Личные данные</h3>
                </div>
                <div class="box-body">
                    <div class="table-responsive">
                        {% if info %}
                            <table class="table table-striped">
                                <tr>
                                    <td class="col-xs-2 col-lg-2">
                                        <strong>
                                            Паспорт
                                        </strong>
                                    </td>
                                    <td>
                                        {{ info.passport_code }} {{ info.passport_number }},
                                        выдан {{ info.passport_issued_date|date:"Y-m-d" }} {{ info.passport_issued }}
                                    </td>
                                </tr>
                                <tr>
                                    <td><strong>Адрес регистрации</strong></td>
                                    <td>{{ info.reg_address }}</td>
                                </tr>
                                <tr>
                                    <td><strong>Адрес проживания</strong></td>
                                    <td>{{ info.fact_address }}</td>
                                </tr>
                                <tr>
                                    <td><strong>Начало обучения</strong></td>
                                    <td>{{ info.start_date|date:"Y-m-d" }}</td>
                                </tr>
                                <tr>
                                    <td><strong>Окончание обучения</strong></td>
                                    <td>{{ info.end_date|date:"Y-m-d" }}</td>
                                </tr>
                            </table>
                            <table class="table table-striped">
                                <tr>
                                    <td class="col-xs-2 col-lg-2"><strong>Характеристика</strong></td>
                                </tr>
                                <tr>
                                    <td>2 курс:</td>
                                    <td>{{ info.characteristic_first_year }}</td>
                                </tr>
                                <tr>
                                    <td>3 курс:</td>
                                    <td>{{ info.characteristic_second_year }}</td>
                                </tr>
                                <tr>
                                    <td>4 курс:</td>
                                    <td>{{ info.characteristic_third_year }}</td>
                                </tr>
                                <tr>
                                    <td>
                                        <strong>
                                            Категория годности
                                        </strong>
                                    </td>
                                    <td>
                                        {{ info.conclusion }}
                                    </td>
                                </tr>
                            </table>
                        {% else %}
                            не заполнено
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xs-4 col-sm-4 col-md-4 col-lg-4">
            <div class="box box-solid">
                <div class="box-header with-border">
                    <h3 class="box-title">Дисциплинарные практики</h3>
                    <button class="pull-right" data-toggle="modal" data-target="#modalAddPenalty"><i class="fa fa-plus"></i></button>
                </div>
                <div class="box-body">
                    <div class="table-responsive">
                        {% if not penalties %}
                            отсутствуют
                        {% else %}
                        <table class="table table-striped">
                            <thead>
                            <tr>
                                <th class="col-xs-3 col-lg-2">тип</th>
                                <th>за что</th>
                                <th>дата</th>
                            </tr>
                            </thead>
                            <tbody>
                            {% for p in penalties %}
                                <tr>
                                    <td>
                                        {{   p.russian_type}}
                                    </td>
                                    <td>
                                        {{ p.comment }}
                                    </td>
                                    <td>
                                        {{ p.date|date:"Y-m-d" }}
                                    </td>
                                </tr>
                            {% endfor %}
                            </tbody>
                        </table>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>




    <div class="modal fade" id="modalAddPenalty" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header text-center">
                    <h4 class="modal-title w-100 font-weight-bold">Дисциплинарная практика</h4>
                </div>
                <form action="{% url 'penalty_add' %}" method="post">
                    <div class="modal-body mx-3">
                        {% csrf_token %}
                        {{ form }}
                        <div class="md-form mb-5">
                            <label for="id_date">Дата</label>
                            <input placeholder="Выберите дату" name="date" type="text" id="id_date" class="form-control datepicker">
                        </div>
                        <div class="md-form mb-4">
                            <label for="penalty_type">Взвод</label>
                            <select id="penalty_type" name="squad_code">
                                {% for opt in penalty_options %}
                                    <option >{{ opt }}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                    <div class="modal-footer d-flex justify-content-center">
                        <button class="btn btn-default" type="submit" id="addPenaltySubmit">Сохранить</button>
                        <button class="btn btn-default" data-dismiss="modal">Отмена</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
{% endblock %}
